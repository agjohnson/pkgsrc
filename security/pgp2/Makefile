# New ports collection makefile for: pgp
# Version required:     2.6.3(i)a
# International PGP homepage is http://www.ifi.uio.no/pgp/
#
# Date created:         8 Jul 1995 (ache@FreeBSD.ORG)
# Whom:                 tv@NetBSD.ORG
#
# $NetBSD: Makefile,v 1.1.1.1 1998/03/18 01:51:14 tv Exp $
# FreeBSD Id: Makefile,v 1.20 1997/08/27 13:06:01 ache Exp
#

.if defined(USE_RSAREF2) && ${USE_RSAREF2} == YES
PKGNAME=        pgp-2.6.3a
LIB_DEPENDS+=	rsaref.2.:${PORTSDIR}/security/rsaref
RSAINC=		-I${PREFIX}/include
RSALIBS=	-L${PREFIX}/lib -lrsaref
RSAOBJS=	rsaglue2.o
CFLAGS=		-DUSA
.else
PKGNAME=        pgp-2.6.3ia
RSAINC=
RSALIBS=
RSAOBJS=	rsaglue1.o
CFLAGS=
.endif

CATEGORIES=	security
DISTNAME=       pgp263is
MASTER_SITES=   ftp://ftp.ifi.uio.no/pub/pgp/2.x/src/ \
		ftp://ftp.kiarchive.ru/pub/unix/crypto/pgp/
WRKSRC=         ${WRKDIR}/src
RESTRICTED=     "Cryptographic software"
PGPLIB=         ${PREFIX}/lib/pgp
CFLAGS+=	-DPGP_SYSTEM_DIR=\\\"${PGPLIB}/\\\"
IS_INTERACTIVE=	yes

MAINTAINER=	packages@NetBSD.ORG

MAN1=		pgp.1

.if ${MACHINE_ARCH} == "i386"
OBJS_EXT=	_80386.o _zmatch.o
ASMFLAG=	-DASM
.elif ${MACHINE_ARCH} == "m68k"
OBJS_EXT=	mc68020.o
ASMFLAG=
.elif ${MACHINE_ARCH} == "sparc"
OBJS_EXT=	sparc.o
ASMFLAG=
.else
OBJS_EXT=
ASMFLAG=	-DPORTABLE -DMPORTABLE
.endif

.if !defined(USE_RSAREF2) || ${USE_RSAREF2} != YES && ${USE_RSAREF2} != NO
pre-fetch:
	@echo
	@echo The variable USE_RSAREF2 must be set to either YES or NO
	@echo in order to build this package.  USA residents not at the
	@echo Massachusetts Institute of Technology MUST set this
	@echo variable to YES.  Users outside the USA MUST set this
	@echo variable to NO.  People at MIT may choose -- NO is faster.
	@false
.endif

post-extract:
	cd ${WRKDIR} && $(EXTRACT_CMD) -xf pgp263ii.tar && rm -f pgp263ii.tar

do-build:
	cd ${WRKSRC} && ${MAKE} all CC=${CC} LD=${CC} OBJS_EXT="${OBJS_EXT}" \
		CFLAGS="${CFLAGS} ${RSAINC} ${ASMFLAG} -O2 -DUNIX -DIDEA32 -DMAX_NAMELEN=255" \
		RSALIBS="${RSALIBS}" RSAOBJS="${RSAOBJS}"

do-install:
	${INSTALL_PROGRAM} ${WRKSRC}/pgp ${PREFIX}/bin
	${INSTALL_DATA} ${WRKDIR}/doc/pgp.1 ${PREFIX}/man/man1
	-${MKDIR} ${PGPLIB}
	cd ${WRKDIR}/doc && ${INSTALL_DATA} pgpdoc1.txt pgpdoc2.txt ${PGPLIB}
	cd ${WRKDIR} && \
		${INSTALL_DATA} de.hlp en.hlp es.hlp fr.hlp pgp.hlp ${PGPLIB}
	[ -f ${PGPLIB}/language.txt ] || \
		${INSTALL_DATA} ${WRKDIR}/language.txt ${PGPLIB}
	[ -f ${PGPLIB}/config.txt ] || \
		${INSTALL_DATA} ${WRKDIR}/config.txt ${PGPLIB}
	[ -f ${PGPLIB}/pgp.hlp ] || \
		${INSTALL_DATA} ${WRKDIR}/en.hlp ${PGPLIB}/pgp.hlp

.include <bsd.port.mk>
