$NetBSD: patch-ah,v 1.1 2009/08/26 22:09:48 wiz Exp $

https://bugs.cihar.com/view.php?id=981

--- libgammu/phone/at/atgen.c.orig	2009-07-09 07:15:17.000000000 +0000
+++ libgammu/phone/at/atgen.c
@@ -2205,12 +2205,11 @@ GSM_Error ATGEN_PrivSetDateTime(GSM_Stat
 	if (error == ERR_UNKNOWN) error = ERR_NOTSUPPORTED;
 
 	if (set_timezone && (
-		(error == ERR_INVALIDDATA
-		&& s->Phone.Data.Priv.ATGEN.ReplyState == AT_Reply_CMEError
+		s->Phone.Data.Priv.ATGEN.ReplyState == AT_Reply_CMEError
+		&& ((error == ERR_INVALIDDATA
 		&& s->Phone.Data.Priv.ATGEN.ErrorCode == 24) ||
 		(error == ERR_INVALIDLOCATION
-		&& s->Phone.Data.Priv.ATGEN.ReplyState == AT_Reply_CMEError
-		&& s->Phone.Data.Priv.ATGEN.ErrorCode == 21)
+		&& s->Phone.Data.Priv.ATGEN.ErrorCode == 21))
 		)) {
 		/*
 		 * Some firmwares of Ericsson R320s don't like the timezone part,
