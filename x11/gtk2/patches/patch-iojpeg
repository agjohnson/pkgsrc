$NetBSD: patch-iojpeg,v 1.1 2009/08/29 05:47:41 dogcow Exp $

Fix a scaling issue with jpeg7; see
http://bugzilla.gnome.org/show_bug.cgi?id=588740 and 
http://bbs.archlinux.org/viewtopic.php?pid=589488#p589488

--- gdk-pixbuf/io-jpeg.c.orig	2009-08-29 13:46:13.000000000 +0900
+++ gdk-pixbuf/io-jpeg.c	2009-08-29 13:49:10.000000000 +0900
@@ -922,13 +922,13 @@ gdk_pixbuf__jpeg_image_load_increment (g
 				}
 			}
 			
-			for (cinfo->scale_denom = 2; cinfo->scale_denom <= 8; cinfo->scale_denom *= 2) {
+			for (cinfo->scale_denom = 2; cinfo->scale_denom <= 16; cinfo->scale_denom++) {
 				jpeg_calc_output_dimensions (cinfo);
 				if (cinfo->output_width < width || cinfo->output_height < height) {
-					cinfo->scale_denom /= 2;
 					break;
 				}
 			}
+			cinfo->scale_denom--;
 			jpeg_calc_output_dimensions (cinfo);
 			
 			context->pixbuf = gdk_pixbuf_new (GDK_COLORSPACE_RGB, 
