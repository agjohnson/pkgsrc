$NetBSD: patch-iojpeg,v 1.2 2009/12/06 22:40:02 wiz Exp $

Fix a scaling issue with jpeg7; see
http://bugzilla.gnome.org/show_bug.cgi?id=588740 and 
http://bbs.archlinux.org/viewtopic.php?pid=589488#p589488

--- gdk-pixbuf/io-jpeg.c.orig	2009-12-01 03:21:23.000000000 +0000
+++ gdk-pixbuf/io-jpeg.c
@@ -922,13 +922,13 @@ gdk_pixbuf__jpeg_image_load_increment (g
 			}
 			
 			cinfo->scale_num = 1;
-			for (cinfo->scale_denom = 2; cinfo->scale_denom <= 8; cinfo->scale_denom *= 2) {
+			for (cinfo->scale_denom = 2; cinfo->scale_denom <= 16; cinfo->scale_denom++) {
 				jpeg_calc_output_dimensions (cinfo);
 				if (cinfo->output_width < width || cinfo->output_height < height) {
-					cinfo->scale_denom /= 2;
 					break;
 				}
 			}
+			cinfo->scale_denom--;
 			jpeg_calc_output_dimensions (cinfo);
 			
 			context->pixbuf = gdk_pixbuf_new (GDK_COLORSPACE_RGB, 
