$NetBSD: patch-aa,v 1.24 2009/10/18 22:22:10 ahoka Exp $

--- configure.orig	2009-10-06 08:43:00.000000000 +0200
+++ configure
@@ -1388,6 +1388,9 @@ if test -z "$_target" ; then
    powerpc) # Darwin returns 'powerpc'
      host_arch=ppc
      ;;
+   mipseb|mipsel) # NetBSD
+     host_arch=mips
+     ;;
    *) # uname -p on Linux returns 'unknown' for the processor type,
       # OpenBSD returns 'Intel Pentium/MMX ("Genuine Intel" 586-class)'
 
@@ -1569,7 +1572,7 @@ else
     cc_name=$cc_name_tmp
     echocheck "$_cc version"
     cc_vendor=gnu
-    cc_version=$($_cc -dumpversion 2>&1)
+    cc_version=$( ( $_cc -dumpversion | sed -e 's/-nb[0-9]//' ) 2>&1 )
     case $cc_version in
       2.96*)
         cc_fail=yes
@@ -1652,7 +1655,7 @@ if x86 ; then
   # gather more CPU information
   pname=$($_cpuinfo | grep 'model name' | cut -d ':' -f 2 | head -n 1)
   pvendor=$($_cpuinfo | grep 'vendor_id' | cut -d ':' -f 2  | cut -d ' ' -f 2 | head -n 1)
-  pfamily=$($_cpuinfo | grep 'cpu family' | cut -d ':' -f 2 | cut -d ' ' -f 2 | head -n 1)
+  pfamily=$($_cpuinfo | grep -i 'cpu family' | cut -d ':' -f 2 | cut -d ' ' -f 2 | head -n 1)
   pmodel=$($_cpuinfo | grep -v 'model name' | grep 'model' | cut -d ':' -f 2 | cut -d ' ' -f 2 | head -n 1)
   pstepping=$($_cpuinfo | grep 'stepping' | cut -d ':' -f 2 | cut -d ' ' -f 2 | head -n 1)
 
@@ -3433,7 +3436,6 @@ test "$_w32threads" = yes && def_threads
 echores "$_w32threads"
 
 echocheck "rpath"
-netbsd &&_rpath=yes
 if test "$_rpath" = yes ; then
   for I in $(echo $extra_ldflags | sed 's/-L//g') ; do
     tmp="$tmp $(echo $I | sed 's/.*/ -L& -Wl,-R&/')"
@@ -4205,7 +4207,11 @@ EOF
            -L/usr/X11/lib -L/usr/lib32 -L/usr/openwin/lib -L/usr/X11R6/lib64 \
            -L/usr/lib ; do
     if netbsd; then
-      _ld_tmp="$I -lXext -lX11 $_ld_pthread -Wl,-R$(echo $I | sed s/^-L//)"
+      if test -n "$I" ; then
+        _ld_tmp="$I -lXext -lX11 $_ld_pthread -Wl,-R$(echo $I | sed s/^-L//)"
+      else
+        _ld_tmp="-lXext -lX11 $_ld_pthread"
+      fi
     else
       _ld_tmp="$I -lXext -lX11 $_ld_pthread"
     fi
@@ -4656,7 +4662,7 @@ fi
 if test "$_aa" = yes ; then
   def_aa='#define CONFIG_AA 1'
   if cygwin ; then
-    libs_mplayer="$libs_mplayer $(aalib-config --libs | cut -d " " -f 2,5,6)"
+    libs_mplayer="$libs_mplayer $(${AALIB_CONFIG} --libs | cut -d " " -f 2,5,6)"
   fi
   _vomodules="aa $_vomodules"
 else
@@ -7221,9 +7227,6 @@ if test "$_x264" = auto ; then
   cat > $TMPC << EOF
 #include <inttypes.h>
 #include <x264.h>
-#if X264_BUILD < 76
-#error We do not support old versions of x264. Get the latest from git.
-#endif
 int main(void) { x264_encoder_open((void*)0); return 0; }
 EOF
   _x264=no
@@ -7593,11 +7596,16 @@ echores "$_tv_v4l1"
 echocheck "Video 4 Linux 2 TV interface"
 if test "$_tv_v4l2" = auto ; then
   _tv_v4l2=no
-  if test "$_tv" = yes && linux ; then
+  if test "$_tv" = yes && (linux || netbsd || openbsd) ; then
     cat > $TMPC <<EOF
 #include <stdlib.h>
+#ifdef __linux__
 #include <linux/types.h>
 #include <linux/videodev2.h>
+#elif defined(__NetBSD__) || defined(__OpenBSD__)
+#include <sys/types.h>
+#include <sys/videoio.h>
+#endif
 int main(void) { return 0; }
 EOF
     cc_check && _tv_v4l2=yes
