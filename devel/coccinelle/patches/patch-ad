$NetBSD: patch-ad,v 1.1 2009/04/06 10:11:05 wiz Exp $

--- Makefile.orig	2009-03-22 20:48:19.000000000 +0000
+++ Makefile
@@ -38,7 +38,7 @@ ifeq ($(FEATURE_PYTHON),1)
 PYCMA=pycaml/pycaml.cma
 PYDIR=pycaml
 PYLIB=dllpycaml_stubs.so
-# the following is essential for Coccinelle to compile under gentoo (wierd)
+# the following is essential for Coccinelle to compile under gentoo (weird)
 OPTLIBFLAGS=-cclib dllpycaml_stubs.so
 else
 PYCMA=
@@ -224,22 +224,36 @@ install-python:
 		$(DESTDIR)$(SHAREDIR)/python/coccilib
 	$(INSTALL_DATA) python/coccilib/coccigui/*.py \
 		$(DESTDIR)$(SHAREDIR)/python/coccilib/coccigui
+	$(INSTALL_DATA) python/coccilib/coccigui/pygui.glade \
+		$(DESTDIR)$(SHAREDIR)/python/coccilib/coccigui
+	$(INSTALL_DATA) python/coccilib/coccigui/pygui.gladep \
+		$(DESTDIR)$(SHAREDIR)/python/coccilib/coccigui
 	$(INSTALL_LIB) dllpycaml_stubs.so $(DESTDIR)$(LIBDIR)
 
+install:
+	@if test -x spatch -a ! -x spatch.opt ; then \
+		$(MAKE) install-byte;fi
+	@if test ! -x spatch -a -x spatch.opt ; then \
+		$(MAKE) install-def; $(MAKE) install-opt;fi
+	@if test -x spatch -a -x spatch.opt ; then \
+		$(MAKE) install-byte; $(MAKE) install-opt;fi
+	@if test ! -x spatch -a ! -x spatch.opt ; then \
+		echo "\n\n\t==> Run 'make', 'make opt', or both first. <==\n\n";fi
+
 # user will use spatch to run spatch.opt (native)
-install: all.opt install-common
+install-def: install-common
 	$(INSTALL_PROGRAM) spatch.opt $(DESTDIR)$(SHAREDIR)
 	cat scripts/spatch.sh | sed "s|SHAREDIR|$(SHAREDIR)|g" > $(DESTDIR)$(BINDIR)/spatch
 	chmod 755 $(DESTDIR)$(BINDIR)/spatch
 
 # user will use spatch to run spatch (bytecode)
-install-byte: all install-common
+install-byte: install-common
 	$(INSTALL_PROGRAM) spatch $(DESTDIR)$(SHAREDIR)
 	cat scripts/spatch.sh | sed "s|\.opt||" | sed "s|SHAREDIR|$(SHAREDIR)|g" > $(DESTDIR)$(BINDIR)/spatch
 	chmod 755 $(DESTDIR)$(BINDIR)/spatch
 
 # user will use spatch.opt to run spatch.opt (native)
-install-opt: all.opt install-common
+install-opt: install-common
 	$(INSTALL_PROGRAM) spatch.opt $(DESTDIR)$(SHAREDIR)
 	cat scripts/spatch.sh | sed "s|SHAREDIR|$(SHAREDIR)|g" > $(DESTDIR)$(BINDIR)/spatch.opt
 	chmod 755 $(DESTDIR)$(BINDIR)/spatch.opt
